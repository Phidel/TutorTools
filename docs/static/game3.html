<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß–∏—Å–ª–æ–≤–æ–π –î–µ—Ç–µ–∫—Ç–∏–≤ 2.1</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #f0f2f5; margin: 0; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); text-align: center; width: 380px; }
        
        #target-number { font-size: 5rem; font-weight: 800; color: #4834d4; margin: 10px 0; transition: transform 0.2s; }
        .target-anim { transform: scale(1.1); }

        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin: 20px 0; }
        
        button.num-btn { 
            padding: 20px 0; font-size: 1.5rem; border: 2px solid #edeff2; border-radius: 12px; 
            background: #f8f9fa; cursor: pointer; transition: all 0.1s; font-weight: bold; color: #555;
            outline: none; -webkit-tap-highlight-color: transparent;
        }
        button.num-btn:active { transform: translateY(2px); background: #e2e4e7; }
        button.num-btn.selected { background-color: #4834d4; color: white; border-color: #341f97; }
        
        #message { height: 30px; font-size: 1.2rem; font-weight: 600; margin-bottom: 10px; color: #666; }
        
        .stats { display: flex; justify-content: space-between; margin-top: 20px; font-size: 1rem; font-weight: bold; background: #eee; padding: 10px; border-radius: 10px; }
        .timer { color: #eb4d4b; }
        .best { color: #2ecc71; margin-top: 10px; font-size: 0.9rem; }
        
        .controls { margin-top: 20px; display: flex; gap: 10px; justify-content: center; }
        button.action-btn { background: #636e72; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .restart-btn { background: #27ae60 !important; display: none; }
        .return{ margin-top:15px; font-size:14px; }
    </style>
</head>
<body>

    <div class="container">
        <div id="message">–†–∞–∑–ª–æ–∂–∏ —á–∏—Å–ª–æ –Ω–∞ –º–Ω–æ–∂–∏—Ç–µ–ª–∏</div>
        <div id="target-number">?</div>
        
        <div class="grid" id="button-grid"></div>

        <div class="stats">
            <div>–°—á—ë—Ç: <span id="score-val">0</span></div>
            <div class="timer">–í—Ä–µ–º—è: <span id="timer-val">30</span>—Å</div>
        </div>
        <div class="best">–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="best-val">0</span></div>

        <div class="controls">
            <button id="skip-btn" class="action-btn" onclick="nextQuestion(true)">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
            <button id="restart-btn" class="action-btn restart-btn" onclick="startGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
    <div class=return><a href="javascript:history.back();">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç</a> </div>
    </div>

    <script>
        const grid = document.getElementById('button-grid');
        const targetEl = document.getElementById('target-number');
        const messageEl = document.getElementById('message');
        const scoreEl = document.getElementById('score-val');
        const timerEl = document.getElementById('timer-val');
        const bestEl = document.getElementById('best-val');
        const restartBtn = document.getElementById('restart-btn');
        const skipBtn = document.getElementById('skip-btn');
        
        let selectedNumbers = [];
        let targetValue = 0;
        let lastTargetValue = 0; // –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤
        let score = 0;
        let timeLeft = 30;
        let timerInterval;

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∫–æ—Ä–¥–∞
        bestEl.innerText = localStorage.getItem('math_record') || 0;

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ 2-9
        function createButtons() {
            grid.innerHTML = '';
            for (let i = 2; i <= 9; i++) {
                const btn = document.createElement('button');
                btn.className = 'num-btn';
                btn.innerText = i;
                btn.onclick = () => handleSelect(i, btn);
                grid.appendChild(btn);
            }
        }

        function startGame() {
            score = 0;
            timeLeft = 30;
            scoreEl.innerText = score;
            timerEl.innerText = timeLeft;
            grid.style.pointerEvents = "auto";
            restartBtn.style.display = "none";
            skipBtn.style.display = "inline-block";
            createButtons();
            nextQuestion();
            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                timerEl.innerText = timeLeft;
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function nextQuestion(isSkip = false) {
            let a, b, newVal;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —á–∏—Å–ª–æ, –ø–æ–∫–∞ –æ–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º
            do {
                a = Math.floor(Math.random() * 8) + 2;
                b = Math.floor(Math.random() * 8) + 2;
                newVal = a * b;
            } while (newVal === lastTargetValue);

            lastTargetValue = newVal;
            targetValue = newVal;
            
            targetEl.innerText = targetValue;
            targetEl.classList.add('target-anim');
            setTimeout(() => targetEl.classList.remove('target-anim'), 200);

            selectedNumbers = [];
            messageEl.innerText = isSkip ? "–ü—Ä–æ–ø—É—â–µ–Ω–æ. –ù–æ–≤–æ–µ —á–∏—Å–ª–æ:" : "–í—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∞ –º–Ω–æ–∂–∏—Ç–µ–ª—è";
            messageEl.style.color = "#666";
            resetButtons();
        }

        function handleSelect(num, btn) {
            if (selectedNumbers.length < 2) {
                selectedNumbers.push(num);
                btn.classList.add('selected');

                if (selectedNumbers.length === 2) {
                    checkAnswer();
                }
            }
        }

        function checkAnswer() {
            const product = selectedNumbers[0] * selectedNumbers[1];
            
            if (product === targetValue) {
                messageEl.innerText = "–í–µ—Ä–Ω–æ! +5 —Å–µ–∫";
                messageEl.style.color = "#27ae60";
                score++;
                scoreEl.innerText = score;
                timeLeft += 5; 
                setTimeout(() => nextQuestion(), 500);
            } else {
                messageEl.innerText = "–û—à–∏–±–∫–∞! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ";
                messageEl.style.color = "#eb4d4b";
                setTimeout(() => {
                    selectedNumbers = [];
                    resetButtons();
                }, 600);
            }
        }

        function resetButtons() {
            Array.from(grid.children).forEach(btn => btn.classList.remove('selected'));
        }

        function endGame() {
            clearInterval(timerInterval);
            targetEl.innerText = "‚åõ";
            messageEl.innerText = `–§–∏–Ω–∏—à! –í–∞—à —Å—á—ë—Ç: ${score}`;
            messageEl.style.color = "#4834d4";
            grid.style.pointerEvents = "none";
            restartBtn.style.display = "inline-block";
            skipBtn.style.display = "none";

            const record = localStorage.getItem('math_record') || 0;
            if (score > record) {
                localStorage.setItem('math_record', score);
                bestEl.innerText = score;
                messageEl.innerText = `–ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥: ${score}! üéâ`;
            }
        }

        startGame();
    </script>
</body>
</html>